# 基于人类活动和建筑环境搭建的商业建筑能耗预测管理模型

# 引言

随着我国经济的快速发展，大型商业建筑数量不断增多，能耗也居高不下。

在商业建筑物中，暖通空调（HVAC）系统用于精确控制空间温度和通风气流，有效优化HVAC系统，实施商业建筑能耗管理的好处不仅包括节能和减少温室气体排放，还包括节省成本、提升企业形象、提高竞争力以及符合法律要求。

因此，该模型设计主要出于以下三点改善空间考虑：

- 通常在设计HVAC系统时，额定量会比实际需要的多20%以上，这导致系统长期处于部分负荷状态。此外，在系统控制方面，为了保证其稳定性和方便性，往往不会启用设备的变频功能，这导致整个建筑物处于最大制冷输出状态，浪费了大量能源。因此，在建筑物设计阶段，准确的热负荷和冷负荷预测非常重要，这有助于估算能源消耗并提高能源性能。
- 在公共场所中，不同区域对于空调冷热源的开机时间、温湿度等需求存在差异，但HVAC终端不能统一实现开关控制。目前，公共场所通常使用机械式手动调节温控器和普通液晶温控器。这些温控器实际上是为家庭设计的。若要确保不会过度供热、过度制冷和人走风机关闭，需要靠“良好的习惯”来实现。但由于这些建筑的各种能源费用由公司或政府承担，而不是个人，这导致人们缺乏节能意识。
- 同时，电力需求存在多样性和不确定性，但一个发电厂发电能力通常是固定的不轻易改变的，通过调控HAVC负荷参与电网削峰填谷，有助于维持系统的稳定运行、减少发电机备用容量以及提高效率，并且有潜力增大电网运行效益。

针对以上三个问题，本文将探讨暖通空调（HVAC）控制系统的额定量预测和智能控制空间温度两部分内容，实现建筑冷热负荷模型的预测和自动控温模型，推动能耗管理系统的建设。通过对大量历史和实时数据进行分析，根据区域电网负荷自动调整供热计划，优化建筑物的能源性能 (EPB) 和 HVAC 系统，创造舒适但节能的空间，可以在不影响用户舒适度的前提下，大幅降低能源消耗，为能源效率的迫切需求提供解决方案。

# 方案概述

我们将使用该智能系统来模拟用户行为，预测未来房间的人流量，并智能控制房间的温度。这个过程包括以下三个步骤：

第一步是人类活动影响预测，旨在预测未来人流量，主要由2个部分组成：输入变量，即历史室内人员流动的数据；输出变量，系统对于输入变量的反应，通常指房间未来的人流密度变化。

第二步涉及预测建筑物的环境影响，主要由三个部分组成：输入变量，包括未来的空间人流密度变化和气象参数；系统结构和特性，即建筑系统的物理描述（如相对空间紧凑度、表面积、墙面积、屋顶面积、总高度、方向、采光面积、玻璃面积分布等）；输出变量，指系统对输入变量的响应，通常是能源消耗，可以实现动态室温和冷却/加热需求的预测模型。

第三步预测接下来一个小时将建筑保持在舒适条件下可实现的最小能耗，结合区域电网负荷，制定最佳控温策略，确定该时刻所需的阀门开度，自动调节阀门开关。

同时，新采集的数据也可作为训练数据，强化学习系统的控制算法。其中温度控制的难点除了预测其负荷以外，还有房间温度的变化。由于温度变化具有延迟性，需要在人流密度上升之前便开启阀门，以便在用户到达之前使房间温度到达设定的舒适温度。在人流密度下降之前，便调节阀门开度以降低能耗。

下图为方法的概述流程图：

![Untitled](%E5%9F%BA%E4%BA%8E%E4%BA%BA%E7%B1%BB%E6%B4%BB%E5%8A%A8%E5%92%8C%E5%BB%BA%E7%AD%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9A%84%E5%95%86%E4%B8%9A%E5%BB%BA%E7%AD%91%E8%83%BD%E8%80%97%E9%A2%84%E6%B5%8B%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9E%8B%20d77b83da8c7a433480f90e8e205327da/Untitled.png)

## 活动影响建筑能耗预测模型

在移动设备已经广泛普及的情况下，我们可以利用人们随身携带的移动设备与房间内的AP（无线访问接入点，如Wi-Fi热点）建立连接，并通过此连接进行信息交互，以识别移动设备的MAC地址并标识用户。通过对移动设备采集的信息及其时间戳的分析，我们可以得出用户的访问记录，从而分析和统计每天到访的用户行为，推断出房间每天的人流量情况。基于房间历史人流量时间序列的特征，我们可以预测未来一段时间的人流量走向。

### 数据收集

- 通过与室内AP（无线访问接入点）建立连接时的交互信息，收集对应此用户的MAC地址和RSSI信号强度；
- 将每个用户的RSSI信号强度转换为与房间的距离，并加上采集时的时间戳，整合成<MAC地址，时间戳，距离>三元组的源记录；
- 根据源记录中的距离，判断进出房间的行为，并将此行为整合成访问记录表，记录表中至少应包括MAC地址、进入时间和出去时间字段；
- 分析所有人的访问记录，得到房间人流密度的变化规律。

### 数据处理

我们将使用不同的数字值来表示15分钟间隔内的拥挤程度（0-10，其中0表示稀疏，10表示密集），以量化收集到的每日人流量密度水平。

**聚类分析**

使用聚类分析方法，将相似的实验日期数据（向量）分组成簇。每个簇代表着一种特定的日期类型，包含了该日期类型在每个时间槽（15分钟）上的人流密度概率。这样，通过将相似的日子聚类到同一个簇中，可以建立起一种模式，以描述该日期类型一天内不同时间槽的人流密度概率。

**模型训练和参数估计**

在初始化参数时，引入实验日期的日期类型变量，如工作日、周末、节日，并迭代地从后验分布中重新采样以优化参数的似然性。选择其中具有最高似然性的簇来完成簇分配，以识别出人流密度模式。

### 模型应用

使用已训练好的模型和参数，对新的观测数据进行预测。

具体预测步骤如下：

1. 确定簇成员：考虑历史数据和当日观测数据的特征，确定下一个时间槽可能属于的簇（日期类型）。计算当前日期属于每个簇的概率，选择具有最高概率的簇作为当前日期所属的簇。
2. 选择人流密度：根据历史模式和簇的特征，选择与所预测时间槽相关联的人流密度等级。
3. 多步预测：即对未来多个时间槽进行预测。每次进行新的预测时，更新之前的人流密度状态向量，以包含最新的观测数据，以实现多步准确预测。

## 环境影响建筑能耗预测模型

![Untitled](%E5%9F%BA%E4%BA%8E%E4%BA%BA%E7%B1%BB%E6%B4%BB%E5%8A%A8%E5%92%8C%E5%BB%BA%E7%AD%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9A%84%E5%95%86%E4%B8%9A%E5%BB%BA%E7%AD%91%E8%83%BD%E8%80%97%E9%A2%84%E6%B5%8B%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9E%8B%20d77b83da8c7a433480f90e8e205327da/Untitled%201.png)

### 数据收集

数据集来自于 *Tsanas* 和 *Xifara* 在 2012 年创建的能效[数据集](http://archive.ics.uci.edu/ml/datasets/energy+efficiency#)， 包含 768 个样本和 8 个特征。 

*Tsanas 和 Xifara*使用 Ecotect 软件模拟了十二种不同的建筑形状来生成这个数据集。通过寻找建筑物的不同参数与建筑供暖/制冷负荷的潜在变化趋势，预测建筑物的最佳能耗。

在模拟过程中假设建筑物位于希腊雅典， 采用 60% 湿度、0.30 m/s 风速和 300 lx 照明水平。

该数据集包括八个标记为 X1、X2、X3 到 X8 的属性，以及两个标记为Y1和 Y2 的决策变量。 

- X1: Relative Compactness 紧凑性指数，即建筑立面的体积与外表面的比率
- X2: Surface Area - m² 表面积
- X3: Wall Area - m² 墙面面积
- X4: Roof Area - m² 屋顶面积
- X5: Overall Height - m 总高度
- X6: Orientation - 2:North, 3:East, 4:South, 5:West 朝向
- X7: Glazing Area - 0%, 10%, 25%, 40% (of floor area) 采光面积
- X8: Glazing Area Distribution (Variance) - 1:Uniform, 2:North, 3:East, 4:South, 5:West 采光面积分布
- Y1: Heating Load - kWh 供暖负荷
- Y2: Cooling Load - kWh 制冷负荷

### 数据处理

**探索变量的统计特性**

- 使用**直方图**可视化变量，下图显示了所有输入和输出变量的经验概率分布。 这些分布表明没有一个变量服从正态分布。
    
    ![Untitled](%E5%9F%BA%E4%BA%8E%E4%BA%BA%E7%B1%BB%E6%B4%BB%E5%8A%A8%E5%92%8C%E5%BB%BA%E7%AD%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9A%84%E5%95%86%E4%B8%9A%E5%BB%BA%E7%AD%91%E8%83%BD%E8%80%97%E9%A2%84%E6%B5%8B%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9E%8B%20d77b83da8c7a433480f90e8e205327da/Untitled%202.png)
    

![Untitled](%E5%9F%BA%E4%BA%8E%E4%BA%BA%E7%B1%BB%E6%B4%BB%E5%8A%A8%E5%92%8C%E5%BB%BA%E7%AD%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9A%84%E5%95%86%E4%B8%9A%E5%BB%BA%E7%AD%91%E8%83%BD%E8%80%97%E9%A2%84%E6%B5%8B%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9E%8B%20d77b83da8c7a433480f90e8e205327da/Untitled%203.png)

- 我们使用**散点图**来检查变量之间的相关性，输入和输出变量之间没有显然的函数关系。

![Untitled](%E5%9F%BA%E4%BA%8E%E4%BA%BA%E7%B1%BB%E6%B4%BB%E5%8A%A8%E5%92%8C%E5%BB%BA%E7%AD%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9A%84%E5%95%86%E4%B8%9A%E5%BB%BA%E7%AD%91%E8%83%BD%E8%80%97%E9%A2%84%E6%B5%8B%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9E%8B%20d77b83da8c7a433480f90e8e205327da/Untitled%204.png)

- 使用**热力图**查看变量之间的相关性。只有部分变量具有强相关性，这意味着我们不能期望传统的学习算法（如线性回归）能够成功地将输入变量映射到输出变量。因此，有必要使用复杂的学习算法，如随机森林，来进行实验。

![Untitled](%E5%9F%BA%E4%BA%8E%E4%BA%BA%E7%B1%BB%E6%B4%BB%E5%8A%A8%E5%92%8C%E5%BB%BA%E7%AD%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9A%84%E5%95%86%E4%B8%9A%E5%BB%BA%E7%AD%91%E8%83%BD%E8%80%97%E9%A2%84%E6%B5%8B%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9E%8B%20d77b83da8c7a433480f90e8e205327da/Untitled%205.png)

- **数据集拆分**：

将数据集拆分为训练集（70%）和测试集（30%），因为变量的值范围不一，我们对其进行特征缩放，以便所有值都保持在可比较的范围内。 所提出模型的性能通过统计性能指标（R-square）进行基准测试

### 模型应用

****模型构建和配置****

- 通过循环迭代回归模型列表中的每个模型，对每个模型分别训练Heating Load 和Cooling Load的预测能力，并计算出训练和测试数据的R-square。
- 回归模型包括：
    - SVR
    - DecisionTreeRegressor
    - KNeighborsRegressor
    - RandomForestRegressor
    - MLPRegressor
    - AdaBoostRegressor
    - GradientBoostingRegressor
    - CatBoostRegressor
- R-square结果如下：

| index | model | train_Heating | test_Heating | train_Cooling | test_Cooling |
| --- | --- | --- | --- | --- | --- |
| 4 | MLPRegressor | 0.877952 | 0.882143 | 0.811571 | 0.825162 |
| 0 | SVR | 0.930441 | 0.910685 | 0.893502 | 0.883685 |
| 2 | KNeighborsRegressor | 0.944607 | 0.906180 | 0.926757 | 0.889375 |
| 5 | AdaBoostRegressor | 0.966272 | 0.964424 | 0.939335 | 0.938410 |
| 1 | DecisionTreeRegressor | 1.000000 | 0.997198 | 1.000000 | 0.947238 |
| 3 | RandomForestRegressor | 0.999523 | 0.997764 | 0.995373 | 0.961183 |
| 6 | GradientBoostingRegressor | 0.998194 | 0.997762 | 0.980388 | 0.976283 |
| 7 | CatBoostRegressor | 0.999814 | 0.999074 | 0.998969 | 0.994610 |

****模型训练和评估****

我们选择其中表现比较优异的模型进行优化。

提高机器学习算法的性能取决于超参数。找到最佳参数可以提高模型的精度。手动查找超参数非常繁琐，因此我们使用一种自动化超参数调整方法——GridSearchCV，它能够计算出模型的最佳参数，让模型更加准确。

由于test_Cooling的结果明显差于test_Heating，因此调参主要以提升test_Cooling的结果为主。

- **DecisionTreeRegressor参数调整**
    - 该模型基于从训练数据中提取决策规则，以发现模式。然而，该模型的泛化能力较差，对训练数据的变化敏感。即使是训练数据集的微小变化，也可能会影响模型的预测准确性。
    - 通过执行网格搜索交叉验证来找到最佳的超参数组合：将数据集分成5个部分，每次使用其中4个部分作为训练集，1个部分作为验证集
    - 调整参数criterion= 'mse', max_depth= 7, max_leaf_nodes= 37, min_samples_leaf= 3, min_samples_split= 12
    - 输出结果：
    
    ```
    R-Squared on Y1test dataset=0.9960724663374239
    R-Squared on Y2test dataset=0.9598515066673416
    ```
    
- **RandomForestRegressor参数调整**
    - 采用观察子集和变量子集来构建决策树。通过构建多个这样的决策树并将它们合并在一起，可以获得更准确和稳定的预测。通常我们将随机森林视为一个黑盒，它接受输入并给出预测，而不必过多担心后端进行的计算。通过调整黑盒本身的参数，可以对模型的性能或资源-时间平衡产生一些影响，从而增加模型的预测能力或使模型更容易训练，但不会改变模型的基本逻辑。
    - 通过调整参数n_estimators =400, max_features = 1, max_depth= 85, bootstrap= True
    - 输出结果：
    
    ```
    R-Squared on Y1test dataset=0.992513402141953
    R-Squared on Y2test dataset=0.9731348598485502
    ```
    
- **GradientBoostingRegressor参数调整**
    - 串行地生成多个弱学习器，每个弱学习器的目标是拟合先前累加模型的损失函数的负梯度，使加上该弱学习器后的累积模型损失往负梯度的方向减少
    - 调整参数learning_rate=1,n_estimators=250, max_depth=4, min_samples_split=3, min_samples_leaf=1, subsample=1.0
    - 输出结果
    
    ```
    R-Squared on Y1test dataset=0.9982636104714018
    R-Squared on Y2test dataset=0.9927592620553332
    ```
    
- **CatBoostRegressor参数调整**
    - "CatBoost"的名称来自两个单词的组合，即“Category”和“Boosting”。与需要从大量数据中学习的DL模型不同，CatBoost可以使用相对较少的数据返回出色的结果。它还减少了对广泛的超参数的调整和过拟合的可能性，从而产生更具有普适性的模型。
    - 调整border_count= 5, depth= 10, iterations= 10000, learning_rate= 0.03, random_state= 42
    - 输出结果
    
    ```
    R-Squared on Y1test dataset=0.9986564263244481
    R-Squared on Y2test dataset=0.9933053867858781
    ```
    
- **MLPRegressor参数调整**
    - 使用多层感知器（Multilayer Perceptron）进行回归任务，但对于特征的选择敏感、需要大量的训练样本以及对模型结构的合理选择
    - 调整参数hidden_layer_sizes = [180,100,20],activation ='relu', solver='lbfgs',max_iter = 10000,random_state = 0
    - 输出结果
    
    ```
    R-Squared on train dataset=0.9962450295106783
    R-Squared on test dataset=0.9902336660399562
    ```
    

### 输出结果

| index | model | train_Heating | test_Heating | train_Cooling | test_Cooling |
| --- | --- | --- | --- | --- | --- |
| 0 | DecisionTreeRegressor | 0.994803 | 0.996072 | 0.967655 | 0.959851 |
| 1 | RandomForestRegressor | 0.998713 | 0.992513 | 0.996212 | 0.973134 |
| 2 | MLPRegressor | 0.999877 | 0.995000 | 0.999602 | 0.988670 |
| 3 | GradientBoostingRegressor | 0.999735 | 0.998263 | 0.998988 | 0.992759 |
| 4 | CatBoostRegressor | 0.999999 | 0.998656 | 0.999999 | 0.993305 |

可以看到，这五种机器学习模型的整体表现都非常优秀。综合性能方面，CatBoostRegressor表现比其他四个模型更出色。选择CatBoostRegressor进行预测结果如下，可以看到结果较好：

![Untitled](%E5%9F%BA%E4%BA%8E%E4%BA%BA%E7%B1%BB%E6%B4%BB%E5%8A%A8%E5%92%8C%E5%BB%BA%E7%AD%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9A%84%E5%95%86%E4%B8%9A%E5%BB%BA%E7%AD%91%E8%83%BD%E8%80%97%E9%A2%84%E6%B5%8B%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9E%8B%20d77b83da8c7a433480f90e8e205327da/Untitled%206.png)

在实际运用中，可以采用投票法，将五个不同的单独的ML模型的输出结合起来，得票最高的模型或各模型之间的一致意见被选中，以产生最终的回归输出，以提高整体性能。

该模型的唯一限制在于缺乏更多实时数据。同时，由于该数据集不包括天气和人流密度等外部因素，需要在实际环境中添加这些因素。

环境监测子系统负责采集、分析和计算室外自然环境信息。采集信息包括温度、湿度、风速、天气状况（晴、多云、雨、雪及其他），其中部分数据可以通过中国气象局-天气预报官网获取。环境监测子系统按时段对采集的数据信息进行分析统计，并将其存入本地数据库服务器。

在获得天气数据和人流密度参数后，更新该模型。

# 方案应用

## 建筑设计阶段

在建筑设计阶段，可以结合当地天气情况，通过建筑环境影响建筑能耗预测模型，建立建筑的节能改造分析模型或一类建筑的基准评价模型，帮助设计师找到最节能的建筑设计方案。

## 建筑使用阶段

在建筑使用阶段，系统会根据人流量预测模型，判断未来一段时间内该房间的人流密度变化，并将数据传入环境影响建筑能耗预测模型，输出未来一个控制周期内的预测负荷值。结合区域电网预测或实时负荷大小，HVAC系统计算出在用户适宜环境周围的一个动态控制测量，温控阀则会根据这个策略调节室内温度，在保证用户舒适度的前提下，与负荷曲线互补运行。

换句话说，如果下一个控制周期（例如15分钟）中区域负荷和建筑预测负荷都预计会比当前周期增加，系统应该在确保用户舒适度的情况下以较低的功率运行，以减少整个区域负荷的增长。当负荷接近峰值时，系统应该以最低功率运行，以减轻负荷并缓解电网压力。当区域负荷开始减少而建筑预测负荷仍在增加时，HVAC系统应及时增加功率以提高用户舒适度，但应注意确保增加的负荷不会产生新的峰值。通过将此控制策略集成到HVAC系统的主控芯片中，并与区域日负荷一起运行，可以有效地平滑负载曲线，减少对电力的需求，并稳定电网运行。

在设定人体适宜环境之后，系统就开始自行学习，理论上可以完全自动运作。

同时，建筑的管理人员，也可以通过手机或者网页端对房间直接进行控制，而最终的用户也可以直接在恒温器上设置个人所需的温度，很好地适应每个房间人员的需求。

## 模型优点

模型的主要优点是以单个房间的需求为导向自动控制，一方面通过预测人流量和智能控制方法满足了人员的舒适度需求，另一方面又减少了物业管理人员的时间成本，同时还实现了建筑的节能，优化大型中央空调系统运行。

## 模型优化空间

- 需要在获得天气数据和人流密度参数后，更新该模型
- 预测模型输入变量种类不全面，如设备散热、照明等未考虑。
- 需要考虑建筑空调系统具有大惯性，无法突变，历史负荷会对当前负荷产生影响，尤其前一时
刻负荷与当前时刻负荷间存在强烈的相关性

# 资料来源

【1】https://[archive.ics.uci.edu/ml/datasets/energy+efficiency#](http://archive.ics.uci.edu/ml/datasets/energy+efficiency#)

【2】Tsanas A, Xifara A. Accurate quantitative estimation of energy performance of residential buildings using statistical machine learning tools[J]. Energy and buildings, 2012, 49: 560-567.

【3】[https://patents.google.com/patent/CN108664620B/zh#citedBy](https://patents.google.com/patent/CN108664620B/zh#citedBy)

【4】王栋,徐青山,陈亮,袁晓冬.参与调峰控制的空调负荷建模仿真研究[J].电力工程技术,2018,37(6):80-86